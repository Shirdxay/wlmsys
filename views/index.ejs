<!DOCTYPE html>
<html lang="en">
  <%-include("./partials/header.ejs") %>
  <body>
    <div class="form-container">
      <form action="/submit" method="POST">
        <h1>Water Level Monitoring (RIMP)</h1>
        <label for="options">Choose an option:</label>
        <select name="options" id="options" onchange="toggleGateInput()">
          <option value="" selected>--- Option ---</option>
          <% mlist.forEach((item)=>{ %>
          <option value="<%= item %>"><%= item %></option>
          <% }); %>
        </select>
        <br />
        <label for="gateOpening">Gate opening [cm]:</label>
        <input
          type="number"
          id="gateOpening"
          name="gateOpening"
          min="0"
          step="0.1"
        />
        <br />
        <label for="gpsLocation">GPS Location:</label>
        <input
          type="text"
          id="gpsLocation"
          name="gpsLocation"
          placeholder="Latitude, Longitude"
          readonly
        />
        <br />
        <button type="submit">Submit</button>
      </form>
    </div>
    <script>
      function toggleGateInput() {
        var select = document.getElementById('options');
        var input = document.getElementById('gateOpening');
        var selectedValue = select.value;
        if (selectedValue.includes('ABC')) {
          input.disabled = true;
        } else {
          input.disabled = false;
        }
      }
      // Run on page load in case default is "ABC"
      function fetchGPSLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              var gpsInput = document.getElementById('gpsLocation');
              gpsInput.value =
                position.coords.latitude + ', ' + position.coords.longitude;
            },
            function (error) {
              var gpsInput = document.getElementById('gpsLocation');
              gpsInput.value = 'Unable to retrieve location';
            }
          );
        } else {
          var gpsInput = document.getElementById('gpsLocation');
          gpsInput.value = 'Geolocation not supported';
        }
      }
      // Fetch GPS location on page load
      window.onload = function () {
        fetchGPSLocation();
      };
    </script>
    <%-include("./partials/footer.ejs") %>
  </body>
</html>
